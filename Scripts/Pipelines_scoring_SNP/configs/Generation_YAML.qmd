---
title: "Generation_YAML"
format: html
editor: visual
---

```{r}
library(yaml)
```

on au total $p = 217{,}000$ SNPs. Ensuite ![Performance de la PLS pour le phénotype CIRC2009 en fonction de la taille du subset](../Plots/Performance_PLS_Subset_Size.png) 

5000 SNP est un bon compromis entre taille du subset et performance prédictive

$n_\text{subset} = 5{,}000$ SNPs sélectionnés à chaque itération

avec 870 itérations, chaque SNP sera selectionné en moyenne 20 fois

```{r}
load("../data/Phenotype.rda")
pheno <- as.data.table(Phenotype)
phenotypes <- names(pheno)[sapply(df, is.numeric)]
phenotypes
```

# Configs RF

```{r}
N_ITER <- 870
SUBSET_SIZE <- 5000
SEED <- 123
OUTER_FOLDS <- 5

for (pheno in phenotypes) {

  cfg <- list(

    data = list(
      phenotype    = "data/Phenotype.rda",
      genomic      = "data/Genomic.rda",
      localisation = "data/localisation.rda"
    ),

    analysis = list(
      phenotype_name = pheno,
      n_iter         = N_ITER,
      subset_size    = SUBSET_SIZE,
      seed           = SEED
    ),

    cv = list(
      outer_folds = 6
    ),

    output = list(
      save_dir = paste0("results/RF_", pheno)
    )
  )

  yaml_file <- paste0("config_RF_", pheno, ".yml")

  write_yaml(cfg, yaml_file)

  message("Written: ", yaml_file)
}

```

# Configs VIP

```{r}
N_ITER <- 870
SUBSET_SIZE <- 5000
SEED <- 123
OUTER_FOLDS <- 5
PHENO_DIR <- "data"
SAVE_DIR_BASE <- "results"


for (pheno in phenotypes) {
  cfg <- list(
    data = list(
      phenotype    = file.path(PHENO_DIR, "Phenotype.rda"),
      genomic      = file.path(PHENO_DIR, "Genomic.rda"),
      localisation = file.path(PHENO_DIR, "localisation.rda")
    ),
    analysis = list(
      phenotype_name = pheno,
      n_iter         = N_ITER,
      subset_size    = SUBSET_SIZE,
      seed           = SEED
    ),
    cv = list(
      outer_folds = OUTER_FOLDS
    ),
    output = list(
      save_dir = file.path(SAVE_DIR_BASE, paste0("VIP_", pheno))
    )
  )

  yaml_file <- paste0("config_VIP_", pheno, ".yml")
  write_yaml(cfg, yaml_file)
  message("Written: ", yaml_file)
}
```
